import { expect, test } from 'vitest';
import * as evaluator from "../src/evaluator";
import getPositionAttributeValue from './utils/getPositionAttributeValue';
import clipboard from 'clipboardy';

test('simple cylinder', () => {
  let { geometry } = evaluator.buildNodes([{"name":"Group Output","label":"","default_label":"Group Output","type":"GROUP_OUTPUT","inputs":[{"name":"Geometry","identifier":"Output_1","type":"GEOMETRY","links":[{"node":"Cylinder","socket":"Mesh"}],"display_shape":"CIRCLE","is_multi_input":false},{"name":"","identifier":"__extend__","type":"CUSTOM","links":[],"display_shape":"CIRCLE","is_multi_input":false}],"outputs":[],"color":[0.6079999804496765,0.6079999804496765,0.6079999804496765],"location":[546.25,-248.251953125],"dimensions":[280,144],"id":"1"},{"name":"Cylinder","label":"","default_label":"Cylinder","type":"MESH_PRIMITIVE_CYLINDER","inputs":[{"name":"Vertices","identifier":"Vertices","type":"INT","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":32},{"name":"Side Segments","identifier":"Side Segments","type":"INT","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":1},{"name":"Fill Segments","identifier":"Fill Segments","type":"INT","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":1},{"name":"Radius","identifier":"Radius","type":"VALUE","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":1},{"name":"Depth","identifier":"Depth","type":"VALUE","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":2}],"outputs":[{"name":"Mesh","identifier":"Mesh","type":"GEOMETRY","links":[{"node":"Group Output","socket":"Output_1"}],"display_shape":"CIRCLE"},{"name":"Top","identifier":"Top","type":"BOOLEAN","links":[],"display_shape":"DIAMOND","value":false},{"name":"Side","identifier":"Side","type":"BOOLEAN","links":[],"display_shape":"DIAMOND","value":false},{"name":"Bottom","identifier":"Bottom","type":"BOOLEAN","links":[],"display_shape":"DIAMOND","value":false}],"color":[0.6079999804496765,0.6079999804496765,0.6079999804496765],"location":[353.25,-249.251953125],"dimensions":[280,518],"id":"2"}]);
  expect(JSON.stringify(getPositionAttributeValue(geometry))).toBe(JSON.stringify([[0,1,1,0.19509032368659973],[0.19509032368659973,1,0.9807852506637573,0.3826834261417389],[0.3826834261417389,1,0.9238795042037964,0.5555702447891235],[0.5555702447891235,1,0.8314695954322815,0.7071067690849304],[0.7071067690849304,1,0.7071067690849304,0.8314695954322815],[0.8314695954322815,1,0.5555702447891235,0.9238795042037964],[0.9238795042037964,1,0.3826834261417389,0.9807852506637573],[0.9807852506637573,1,0.19509032368659973,1],[1,1,6.123234262925839e-17,0.9807852506637573],[0.9807852506637573,1,-0.19509032368659973,0.9238795042037964],[0.9238795042037964,1,-0.3826834261417389,0.8314695954322815],[0.8314695954322815,1,-0.5555702447891235,0.7071067690849304],[0.7071067690849304,1,-0.7071067690849304,0.5555702447891235],[0.5555702447891235,1,-0.8314695954322815,0.3826834261417389],[0.3826834261417389,1,-0.9238795042037964,0.19509032368659973],[0.19509032368659973,1,-0.9807852506637573,1.2246468525851679e-16],[1.2246468525851679e-16,1,-1,-0.19509032368659973],[-0.19509032368659973,1,-0.9807852506637573,-0.3826834261417389],[-0.3826834261417389,1,-0.9238795042037964,-0.5555702447891235],[-0.5555702447891235,1,-0.8314695954322815,-0.7071067690849304],[-0.7071067690849304,1,-0.7071067690849304,-0.8314695954322815],[-0.8314695954322815,1,-0.5555702447891235,-0.9238795042037964],[-0.9238795042037964,1,-0.3826834261417389,-0.9807852506637573],[-0.9807852506637573,1,-0.19509032368659973,-1],[-1,1,-1.8369701465288538e-16,-0.9807852506637573],[-0.9807852506637573,1,0.19509032368659973,-0.9238795042037964],[-0.9238795042037964,1,0.3826834261417389,-0.8314695954322815],[-0.8314695954322815,1,0.5555702447891235,-0.7071067690849304],[-0.7071067690849304,1,0.7071067690849304,-0.5555702447891235],[-0.5555702447891235,1,0.8314695954322815,-0.3826834261417389],[-0.3826834261417389,1,0.9238795042037964,-0.19509032368659973],[-0.19509032368659973,1,0.9807852506637573,-2.4492937051703357e-16],[-2.4492937051703357e-16,1,1,0],[0,-1,1,0.19509032368659973],[0.19509032368659973,-1,0.9807852506637573,0.3826834261417389],[0.3826834261417389,-1,0.9238795042037964,0.5555702447891235],[0.5555702447891235,-1,0.8314695954322815,0.7071067690849304],[0.7071067690849304,-1,0.7071067690849304,0.8314695954322815],[0.8314695954322815,-1,0.5555702447891235,0.9238795042037964],[0.9238795042037964,-1,0.3826834261417389,0.9807852506637573],[0.9807852506637573,-1,0.19509032368659973,1],[1,-1,6.123234262925839e-17,0.9807852506637573],[0.9807852506637573,-1,-0.19509032368659973,0.9238795042037964],[0.9238795042037964,-1,-0.3826834261417389,0.8314695954322815],[0.8314695954322815,-1,-0.5555702447891235,0.7071067690849304],[0.7071067690849304,-1,-0.7071067690849304,0.5555702447891235],[0.5555702447891235,-1,-0.8314695954322815,0.3826834261417389],[0.3826834261417389,-1,-0.9238795042037964,0.19509032368659973],[0.19509032368659973,-1,-0.9807852506637573,1.2246468525851679e-16],[1.2246468525851679e-16,-1,-1,-0.19509032368659973],[-0.19509032368659973,-1,-0.9807852506637573,-0.3826834261417389],[-0.3826834261417389,-1,-0.9238795042037964,-0.5555702447891235],[-0.5555702447891235,-1,-0.8314695954322815,-0.7071067690849304],[-0.7071067690849304,-1,-0.7071067690849304,-0.8314695954322815],[-0.8314695954322815,-1,-0.5555702447891235,-0.9238795042037964],[-0.9238795042037964,-1,-0.3826834261417389,-0.9807852506637573],[-0.9807852506637573,-1,-0.19509032368659973,-1],[-1,-1,-1.8369701465288538e-16,-0.9807852506637573],[-0.9807852506637573,-1,0.19509032368659973,-0.9238795042037964],[-0.9238795042037964,-1,0.3826834261417389,-0.8314695954322815],[-0.8314695954322815,-1,0.5555702447891235,-0.7071067690849304],[-0.7071067690849304,-1,0.7071067690849304,-0.5555702447891235],[-0.5555702447891235,-1,0.8314695954322815,-0.3826834261417389],[-0.3826834261417389,-1,0.9238795042037964,-0.19509032368659973],[-0.19509032368659973,-1,0.9807852506637573,-2.4492937051703357e-16],[-2.4492937051703357e-16,-1,1,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,1,0.19509032368659973],[0.19509032368659973,1,0.9807852506637573,0.3826834261417389],[0.3826834261417389,1,0.9238795042037964,0.5555702447891235],[0.5555702447891235,1,0.8314695954322815,0.7071067690849304],[0.7071067690849304,1,0.7071067690849304,0.8314695954322815],[0.8314695954322815,1,0.5555702447891235,0.9238795042037964],[0.9238795042037964,1,0.3826834261417389,0.9807852506637573],[0.9807852506637573,1,0.19509032368659973,1],[1,1,6.123234262925839e-17,0.9807852506637573],[0.9807852506637573,1,-0.19509032368659973,0.9238795042037964],[0.9238795042037964,1,-0.3826834261417389,0.8314695954322815],[0.8314695954322815,1,-0.5555702447891235,0.7071067690849304],[0.7071067690849304,1,-0.7071067690849304,0.5555702447891235],[0.5555702447891235,1,-0.8314695954322815,0.3826834261417389],[0.3826834261417389,1,-0.9238795042037964,0.19509032368659973],[0.19509032368659973,1,-0.9807852506637573,1.2246468525851679e-16],[1.2246468525851679e-16,1,-1,-0.19509032368659973],[-0.19509032368659973,1,-0.9807852506637573,-0.3826834261417389],[-0.3826834261417389,1,-0.9238795042037964,-0.5555702447891235],[-0.5555702447891235,1,-0.8314695954322815,-0.7071067690849304],[-0.7071067690849304,1,-0.7071067690849304,-0.8314695954322815],[-0.8314695954322815,1,-0.5555702447891235,-0.9238795042037964],[-0.9238795042037964,1,-0.3826834261417389,-0.9807852506637573],[-0.9807852506637573,1,-0.19509032368659973,-1],[-1,1,-1.8369701465288538e-16,-0.9807852506637573],[-0.9807852506637573,1,0.19509032368659973,-0.9238795042037964],[-0.9238795042037964,1,0.3826834261417389,-0.8314695954322815],[-0.8314695954322815,1,0.5555702447891235,-0.7071067690849304],[-0.7071067690849304,1,0.7071067690849304,-0.5555702447891235],[-0.5555702447891235,1,0.8314695954322815,-0.3826834261417389],[-0.3826834261417389,1,0.9238795042037964,-0.19509032368659973],[-0.19509032368659973,1,0.9807852506637573,-2.4492937051703357e-16],[-2.4492937051703357e-16,1,1,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,1,0.19509032368659973],[0.19509032368659973,-1,0.9807852506637573,0.3826834261417389],[0.3826834261417389,-1,0.9238795042037964,0.5555702447891235],[0.5555702447891235,-1,0.8314695954322815,0.7071067690849304],[0.7071067690849304,-1,0.7071067690849304,0.8314695954322815],[0.8314695954322815,-1,0.5555702447891235,0.9238795042037964],[0.9238795042037964,-1,0.3826834261417389,0.9807852506637573],[0.9807852506637573,-1,0.19509032368659973,1],[1,-1,6.123234262925839e-17,0.9807852506637573],[0.9807852506637573,-1,-0.19509032368659973,0.9238795042037964],[0.9238795042037964,-1,-0.3826834261417389,0.8314695954322815],[0.8314695954322815,-1,-0.5555702447891235,0.7071067690849304],[0.7071067690849304,-1,-0.7071067690849304,0.5555702447891235],[0.5555702447891235,-1,-0.8314695954322815,0.3826834261417389],[0.3826834261417389,-1,-0.9238795042037964,0.19509032368659973],[0.19509032368659973,-1,-0.9807852506637573,1.2246468525851679e-16],[1.2246468525851679e-16,-1,-1,-0.19509032368659973],[-0.19509032368659973,-1,-0.9807852506637573,-0.3826834261417389],[-0.3826834261417389,-1,-0.9238795042037964,-0.5555702447891235],[-0.5555702447891235,-1,-0.8314695954322815,-0.7071067690849304],[-0.7071067690849304,-1,-0.7071067690849304,-0.8314695954322815],[-0.8314695954322815,-1,-0.5555702447891235,-0.9238795042037964],[-0.9238795042037964,-1,-0.3826834261417389,-0.9807852506637573],[-0.9807852506637573,-1,-0.19509032368659973,-1],[-1,-1,-1.8369701465288538e-16,-0.9807852506637573],[-0.9807852506637573,-1,0.19509032368659973,-0.9238795042037964],[-0.9238795042037964,-1,0.3826834261417389,-0.8314695954322815],[-0.8314695954322815,-1,0.5555702447891235,-0.7071067690849304],[-0.7071067690849304,-1,0.7071067690849304,-0.5555702447891235],[-0.5555702447891235,-1,0.8314695954322815,-0.3826834261417389],[-0.3826834261417389,-1,0.9238795042037964,-0.19509032368659973],[-0.19509032368659973,-1,0.9807852506637573,-2.4492937051703357e-16],[-2.4492937051703357e-16,-1,1,null]]));
});

test('changed params', () => {
  let { geometry } = evaluator.buildNodes([{"name":"Group Output","label":"","default_label":"Group Output","type":"GROUP_OUTPUT","inputs":[{"name":"Geometry","identifier":"Output_1","type":"GEOMETRY","links":[{"node":"Cylinder","socket":"Mesh"}],"display_shape":"CIRCLE","is_multi_input":false},{"name":"","identifier":"__extend__","type":"CUSTOM","links":[],"display_shape":"CIRCLE","is_multi_input":false}],"outputs":[],"color":[0.6079999804496765,0.6079999804496765,0.6079999804496765],"location":[546.25,-248.251953125],"dimensions":[280,144],"id":"1"},{"name":"Cylinder","label":"","default_label":"Cylinder","type":"MESH_PRIMITIVE_CYLINDER","inputs":[{"name":"Vertices","identifier":"Vertices","type":"INT","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":16},{"name":"Side Segments","identifier":"Side Segments","type":"INT","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":2},{"name":"Fill Segments","identifier":"Fill Segments","type":"INT","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":2},{"name":"Radius","identifier":"Radius","type":"VALUE","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":1},{"name":"Depth","identifier":"Depth","type":"VALUE","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":2}],"outputs":[{"name":"Mesh","identifier":"Mesh","type":"GEOMETRY","links":[{"node":"Group Output","socket":"Output_1"}],"display_shape":"CIRCLE"},{"name":"Top","identifier":"Top","type":"BOOLEAN","links":[],"display_shape":"DIAMOND","value":false},{"name":"Side","identifier":"Side","type":"BOOLEAN","links":[],"display_shape":"DIAMOND","value":false},{"name":"Bottom","identifier":"Bottom","type":"BOOLEAN","links":[],"display_shape":"DIAMOND","value":false}],"color":[0.6079999804496765,0.6079999804496765,0.6079999804496765],"location":[353.25,-249.251953125],"dimensions":[280,518],"id":"2"}]);
  expect(JSON.stringify(getPositionAttributeValue(geometry))).toBe(JSON.stringify([[0,1,1,0.3826834261417389],[0.3826834261417389,1,0.9238795042037964,0.7071067690849304],[0.7071067690849304,1,0.7071067690849304,0.9238795042037964],[0.9238795042037964,1,0.3826834261417389,1],[1,1,6.123234262925839e-17,0.9238795042037964],[0.9238795042037964,1,-0.3826834261417389,0.7071067690849304],[0.7071067690849304,1,-0.7071067690849304,0.3826834261417389],[0.3826834261417389,1,-0.9238795042037964,1.2246468525851679e-16],[1.2246468525851679e-16,1,-1,-0.3826834261417389],[-0.3826834261417389,1,-0.9238795042037964,-0.7071067690849304],[-0.7071067690849304,1,-0.7071067690849304,-0.9238795042037964],[-0.9238795042037964,1,-0.3826834261417389,-1],[-1,1,-1.8369701465288538e-16,-0.9238795042037964],[-0.9238795042037964,1,0.3826834261417389,-0.7071067690849304],[-0.7071067690849304,1,0.7071067690849304,-0.3826834261417389],[-0.3826834261417389,1,0.9238795042037964,-2.4492937051703357e-16],[-2.4492937051703357e-16,1,1,0],[0,0,1,0.3826834261417389],[0.3826834261417389,0,0.9238795042037964,0.7071067690849304],[0.7071067690849304,0,0.7071067690849304,0.9238795042037964],[0.9238795042037964,0,0.3826834261417389,1],[1,0,6.123234262925839e-17,0.9238795042037964],[0.9238795042037964,0,-0.3826834261417389,0.7071067690849304],[0.7071067690849304,0,-0.7071067690849304,0.3826834261417389],[0.3826834261417389,0,-0.9238795042037964,1.2246468525851679e-16],[1.2246468525851679e-16,0,-1,-0.3826834261417389],[-0.3826834261417389,0,-0.9238795042037964,-0.7071067690849304],[-0.7071067690849304,0,-0.7071067690849304,-0.9238795042037964],[-0.9238795042037964,0,-0.3826834261417389,-1],[-1,0,-1.8369701465288538e-16,-0.9238795042037964],[-0.9238795042037964,0,0.3826834261417389,-0.7071067690849304],[-0.7071067690849304,0,0.7071067690849304,-0.3826834261417389],[-0.3826834261417389,0,0.9238795042037964,-2.4492937051703357e-16],[-2.4492937051703357e-16,0,1,0],[0,-1,1,0.3826834261417389],[0.3826834261417389,-1,0.9238795042037964,0.7071067690849304],[0.7071067690849304,-1,0.7071067690849304,0.9238795042037964],[0.9238795042037964,-1,0.3826834261417389,1],[1,-1,6.123234262925839e-17,0.9238795042037964],[0.9238795042037964,-1,-0.3826834261417389,0.7071067690849304],[0.7071067690849304,-1,-0.7071067690849304,0.3826834261417389],[0.3826834261417389,-1,-0.9238795042037964,1.2246468525851679e-16],[1.2246468525851679e-16,-1,-1,-0.3826834261417389],[-0.3826834261417389,-1,-0.9238795042037964,-0.7071067690849304],[-0.7071067690849304,-1,-0.7071067690849304,-0.9238795042037964],[-0.9238795042037964,-1,-0.3826834261417389,-1],[-1,-1,-1.8369701465288538e-16,-0.9238795042037964],[-0.9238795042037964,-1,0.3826834261417389,-0.7071067690849304],[-0.7071067690849304,-1,0.7071067690849304,-0.3826834261417389],[-0.3826834261417389,-1,0.9238795042037964,-2.4492937051703357e-16],[-2.4492937051703357e-16,-1,1,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,0,0],[0,1,1,0.3826834261417389],[0.3826834261417389,1,0.9238795042037964,0.7071067690849304],[0.7071067690849304,1,0.7071067690849304,0.9238795042037964],[0.9238795042037964,1,0.3826834261417389,1],[1,1,6.123234262925839e-17,0.9238795042037964],[0.9238795042037964,1,-0.3826834261417389,0.7071067690849304],[0.7071067690849304,1,-0.7071067690849304,0.3826834261417389],[0.3826834261417389,1,-0.9238795042037964,1.2246468525851679e-16],[1.2246468525851679e-16,1,-1,-0.3826834261417389],[-0.3826834261417389,1,-0.9238795042037964,-0.7071067690849304],[-0.7071067690849304,1,-0.7071067690849304,-0.9238795042037964],[-0.9238795042037964,1,-0.3826834261417389,-1],[-1,1,-1.8369701465288538e-16,-0.9238795042037964],[-0.9238795042037964,1,0.3826834261417389,-0.7071067690849304],[-0.7071067690849304,1,0.7071067690849304,-0.3826834261417389],[-0.3826834261417389,1,0.9238795042037964,-2.4492937051703357e-16],[-2.4492937051703357e-16,1,1,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,0,0],[0,-1,1,0.3826834261417389],[0.3826834261417389,-1,0.9238795042037964,0.7071067690849304],[0.7071067690849304,-1,0.7071067690849304,0.9238795042037964],[0.9238795042037964,-1,0.3826834261417389,1],[1,-1,6.123234262925839e-17,0.9238795042037964],[0.9238795042037964,-1,-0.3826834261417389,0.7071067690849304],[0.7071067690849304,-1,-0.7071067690849304,0.3826834261417389],[0.3826834261417389,-1,-0.9238795042037964,1.2246468525851679e-16],[1.2246468525851679e-16,-1,-1,-0.3826834261417389],[-0.3826834261417389,-1,-0.9238795042037964,-0.7071067690849304],[-0.7071067690849304,-1,-0.7071067690849304,-0.9238795042037964],[-0.9238795042037964,-1,-0.3826834261417389,-1],[-1,-1,-1.8369701465288538e-16,-0.9238795042037964],[-0.9238795042037964,-1,0.3826834261417389,-0.7071067690849304],[-0.7071067690849304,-1,0.7071067690849304,-0.3826834261417389],[-0.3826834261417389,-1,0.9238795042037964,-2.4492937051703357e-16],[-2.4492937051703357e-16,-1,1,null]]));
});