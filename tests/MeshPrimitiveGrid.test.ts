import { expect, test } from 'vitest';
import * as evaluator from "../src/evaluator";
import getPositionAttributeValue from './utils/getPositionAttributeValue';
import clipboard from 'clipboardy';

test('simple grid', () => {
  let { geometry } = evaluator.buildNodes([{"name":"Grid","label":"","default_label":"Grid","type":"MESH_PRIMITIVE_GRID","inputs":[{"name":"Size X","identifier":"Size X","type":"VALUE","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":1},{"name":"Size Y","identifier":"Size Y","type":"VALUE","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":1},{"name":"Vertices X","identifier":"Vertices X","type":"INT","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":3},{"name":"Vertices Y","identifier":"Vertices Y","type":"INT","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":3}],"outputs":[{"name":"Mesh","identifier":"Mesh","type":"GEOMETRY","links":[{"node":"Group Output","socket":"Output_1"}],"display_shape":"CIRCLE"}],"color":[0.6079999804496765,0.6079999804496765,0.6079999804496765],"location":[364.25,-183.251953125],"dimensions":[280,282],"id":"1"},{"name":"Group Output","label":"","default_label":"Group Output","type":"GROUP_OUTPUT","inputs":[{"name":"Geometry","identifier":"Output_1","type":"GEOMETRY","links":[{"node":"Grid","socket":"Mesh"}],"display_shape":"CIRCLE","is_multi_input":false},{"name":"","identifier":"__extend__","type":"CUSTOM","links":[],"display_shape":"CIRCLE","is_multi_input":false}],"outputs":[],"color":[0.6079999804496765,0.6079999804496765,0.6079999804496765],"location":[546.25,-248.251953125],"dimensions":[280,144],"id":"2"}]);
  expect(JSON.stringify(getPositionAttributeValue(geometry))).toBe(JSON.stringify([[-0.5,0.5,0,-0.1666666716337204],[-0.1666666716337204,0.5,0,0.1666666716337204],[0.1666666716337204,0.5,0,0.5],[0.5,0.5,0,-0.5],[-0.5,0.1666666716337204,0,-0.1666666716337204],[-0.1666666716337204,0.1666666716337204,0,0.1666666716337204],[0.1666666716337204,0.1666666716337204,0,0.5],[0.5,0.1666666716337204,0,-0.5],[-0.5,-0.1666666716337204,0,-0.1666666716337204],[-0.1666666716337204,-0.1666666716337204,0,0.1666666716337204],[0.1666666716337204,-0.1666666716337204,0,0.5],[0.5,-0.1666666716337204,0,-0.5],[-0.5,-0.5,0,-0.1666666716337204],[-0.1666666716337204,-0.5,0,0.1666666716337204],[0.1666666716337204,-0.5,0,0.5],[0.5,-0.5,0,null]]));
});

test('changed parameters', () => {
  let { geometry } = evaluator.buildNodes([{"name":"Grid","label":"","default_label":"Grid","type":"MESH_PRIMITIVE_GRID","inputs":[{"name":"Size X","identifier":"Size X","type":"VALUE","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":2},{"name":"Size Y","identifier":"Size Y","type":"VALUE","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":3},{"name":"Vertices X","identifier":"Vertices X","type":"INT","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":5},{"name":"Vertices Y","identifier":"Vertices Y","type":"INT","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":3}],"outputs":[{"name":"Mesh","identifier":"Mesh","type":"GEOMETRY","links":[{"node":"Group Output","socket":"Output_1"}],"display_shape":"CIRCLE"}],"color":[0.6079999804496765,0.6079999804496765,0.6079999804496765],"location":[364.25,-183.251953125],"dimensions":[280,282],"id":"1"},{"name":"Group Output","label":"","default_label":"Group Output","type":"GROUP_OUTPUT","inputs":[{"name":"Geometry","identifier":"Output_1","type":"GEOMETRY","links":[{"node":"Grid","socket":"Mesh"}],"display_shape":"CIRCLE","is_multi_input":false},{"name":"","identifier":"__extend__","type":"CUSTOM","links":[],"display_shape":"CIRCLE","is_multi_input":false}],"outputs":[],"color":[0.6079999804496765,0.6079999804496765,0.6079999804496765],"location":[546.25,-248.251953125],"dimensions":[280,144],"id":"2"}]);
  expect(JSON.stringify(getPositionAttributeValue(geometry))).toBe(JSON.stringify([[-1,1.5,0,-0.6000000238418579],[-0.6000000238418579,1.5,0,-0.20000000298023224],[-0.20000000298023224,1.5,0,0.20000000298023224],[0.20000000298023224,1.5,0,0.6000000238418579],[0.6000000238418579,1.5,0,1],[1,1.5,0,-1],[-1,0.5,0,-0.6000000238418579],[-0.6000000238418579,0.5,0,-0.20000000298023224],[-0.20000000298023224,0.5,0,0.20000000298023224],[0.20000000298023224,0.5,0,0.6000000238418579],[0.6000000238418579,0.5,0,1],[1,0.5,0,-1],[-1,-0.5,0,-0.6000000238418579],[-0.6000000238418579,-0.5,0,-0.20000000298023224],[-0.20000000298023224,-0.5,0,0.20000000298023224],[0.20000000298023224,-0.5,0,0.6000000238418579],[0.6000000238418579,-0.5,0,1],[1,-0.5,0,-1],[-1,-1.5,0,-0.6000000238418579],[-0.6000000238418579,-1.5,0,-0.20000000298023224],[-0.20000000298023224,-1.5,0,0.20000000298023224],[0.20000000298023224,-1.5,0,0.6000000238418579],[0.6000000238418579,-1.5,0,1],[1,-1.5,0,null]]));
});

