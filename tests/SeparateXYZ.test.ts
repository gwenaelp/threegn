import { expect, test } from 'vitest';
import * as evaluator from "../src/evaluator";
import getPositionAttributeValue from './utils/getPositionAttributeValue';

test('simple separate xyz', () => {
  let { geometry } = evaluator.buildNodes([{"name":"Group Output","label":"","default_label":"Group Output","type":"GROUP_OUTPUT","inputs":[{"name":"Geometry","identifier":"Output_1","type":"GEOMETRY","links":[{"node":"Cylinder","socket":"Mesh"}],"display_shape":"CIRCLE","is_multi_input":false},{"name":"","identifier":"__extend__","type":"CUSTOM","links":[],"display_shape":"CIRCLE","is_multi_input":false}],"outputs":[],"color":[0.6079999804496765,0.6079999804496765,0.6079999804496765],"location":[546.25,-248.251953125],"dimensions":[280,144],"id":"1"},{"name":"Cylinder","label":"","default_label":"Cylinder","type":"MESH_PRIMITIVE_CYLINDER","inputs":[{"name":"Vertices","identifier":"Vertices","type":"INT","links":[{"node":"Separate XYZ","socket":"X"}],"display_shape":"CIRCLE","is_multi_input":false,"value":32},{"name":"Side Segments","identifier":"Side Segments","type":"INT","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":1},{"name":"Fill Segments","identifier":"Fill Segments","type":"INT","links":[],"display_shape":"CIRCLE","is_multi_input":false,"value":1},{"name":"Radius","identifier":"Radius","type":"VALUE","links":[{"node":"Separate XYZ","socket":"Y"}],"display_shape":"CIRCLE","is_multi_input":false,"value":1},{"name":"Depth","identifier":"Depth","type":"VALUE","links":[{"node":"Separate XYZ","socket":"Z"}],"display_shape":"CIRCLE","is_multi_input":false,"value":2}],"outputs":[{"name":"Mesh","identifier":"Mesh","type":"GEOMETRY","links":[{"node":"Group Output","socket":"Output_1"}],"display_shape":"CIRCLE"},{"name":"Top","identifier":"Top","type":"BOOLEAN","links":[],"display_shape":"DIAMOND","value":false},{"name":"Side","identifier":"Side","type":"BOOLEAN","links":[],"display_shape":"DIAMOND","value":false},{"name":"Bottom","identifier":"Bottom","type":"BOOLEAN","links":[],"display_shape":"DIAMOND","value":false}],"color":[0.6079999804496765,0.6079999804496765,0.6079999804496765],"location":[367.25,-245.251953125],"dimensions":[280,518],"id":"2"},{"name":"Vector","label":"","default_label":"Vector","type":"INPUT_VECTOR","inputs":[],"outputs":[{"name":"Vector","identifier":"Vector","type":"VECTOR","links":[{"node":"Separate XYZ","socket":"Vector"}],"display_shape":"CIRCLE","value":[20,2,3]}],"color":[0.6079999804496765,0.6079999804496765,0.6079999804496765],"location":[0.25,-227.251953125],"dimensions":[280,240],"id":"3"},{"name":"Separate XYZ","label":"","default_label":"Separate XYZ","type":"SEPXYZ","inputs":[{"name":"Vector","identifier":"Vector","type":"VECTOR","links":[{"node":"Vector","socket":"Vector"}],"display_shape":"DIAMOND_DOT","is_multi_input":false,"value":[0,0,0]}],"outputs":[{"name":"X","identifier":"X","type":"VALUE","links":[{"node":"Cylinder","socket":"Vertices"}],"display_shape":"DIAMOND_DOT","value":0},{"name":"Y","identifier":"Y","type":"VALUE","links":[{"node":"Cylinder","socket":"Radius"}],"display_shape":"DIAMOND_DOT","value":0},{"name":"Z","identifier":"Z","type":"VALUE","links":[{"node":"Cylinder","socket":"Depth"}],"display_shape":"DIAMOND_DOT","value":0}],"color":[0.6079999804496765,0.6079999804496765,0.6079999804496765],"location":[186.25,-228.251953125],"dimensions":[280,358],"id":"4"}]);
  expect(JSON.stringify(getPositionAttributeValue(geometry))).toBe(JSON.stringify([[0,1.5,2,1.4142135381698608],[1.4142135381698608,1.5,1.4142135381698608,2],[2,1.5,1.2246468525851679e-16,1.4142135381698608],[1.4142135381698608,1.5,-1.4142135381698608,2.4492937051703357e-16],[2.4492937051703357e-16,1.5,-2,-1.4142135381698608],[-1.4142135381698608,1.5,-1.4142135381698608,-2],[-2,1.5,-3.6739402930577075e-16,-1.4142135381698608],[-1.4142135381698608,1.5,1.4142135381698608,-4.898587410340671e-16],[-4.898587410340671e-16,1.5,2,0],[0,-1.5,2,1.4142135381698608],[1.4142135381698608,-1.5,1.4142135381698608,2],[2,-1.5,1.2246468525851679e-16,1.4142135381698608],[1.4142135381698608,-1.5,-1.4142135381698608,2.4492937051703357e-16],[2.4492937051703357e-16,-1.5,-2,-1.4142135381698608],[-1.4142135381698608,-1.5,-1.4142135381698608,-2],[-2,-1.5,-3.6739402930577075e-16,-1.4142135381698608],[-1.4142135381698608,-1.5,1.4142135381698608,-4.898587410340671e-16],[-4.898587410340671e-16,-1.5,2,0],[0,1.5,0,0],[0,1.5,0,0],[0,1.5,0,0],[0,1.5,0,0],[0,1.5,0,0],[0,1.5,0,0],[0,1.5,0,0],[0,1.5,0,0],[0,1.5,2,1.4142135381698608],[1.4142135381698608,1.5,1.4142135381698608,2],[2,1.5,1.2246468525851679e-16,1.4142135381698608],[1.4142135381698608,1.5,-1.4142135381698608,2.4492937051703357e-16],[2.4492937051703357e-16,1.5,-2,-1.4142135381698608],[-1.4142135381698608,1.5,-1.4142135381698608,-2],[-2,1.5,-3.6739402930577075e-16,-1.4142135381698608],[-1.4142135381698608,1.5,1.4142135381698608,-4.898587410340671e-16],[-4.898587410340671e-16,1.5,2,0],[0,-1.5,0,0],[0,-1.5,0,0],[0,-1.5,0,0],[0,-1.5,0,0],[0,-1.5,0,0],[0,-1.5,0,0],[0,-1.5,0,0],[0,-1.5,0,0],[0,-1.5,2,1.4142135381698608],[1.4142135381698608,-1.5,1.4142135381698608,2],[2,-1.5,1.2246468525851679e-16,1.4142135381698608],[1.4142135381698608,-1.5,-1.4142135381698608,2.4492937051703357e-16],[2.4492937051703357e-16,-1.5,-2,-1.4142135381698608],[-1.4142135381698608,-1.5,-1.4142135381698608,-2],[-2,-1.5,-3.6739402930577075e-16,-1.4142135381698608],[-1.4142135381698608,-1.5,1.4142135381698608,-4.898587410340671e-16],[-4.898587410340671e-16,-1.5,2,null]]));
});
